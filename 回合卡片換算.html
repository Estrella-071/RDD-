<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>卡片數 / 回合數 換算器</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <style>
    :root {
      --bg-color: #f9f9f9;
      --text-color: #333;
      --container-bg: #fff;
      --primary-color: #3498db;
      --primary-hover: #2980b9;
      --table-border: #ddd;
      --header-bg: #3498db;
      --header-text: #fff;
      --shadow-light: rgba(0, 0, 0, 0.1);
      --shadow-dark: rgba(0, 0, 0, 0.2);
    }
    .dark {
      --bg-color: #121212;
      --text-color: #ddd;
      --container-bg: #1e1e1e;
      --primary-color: #2980b9;
      --primary-hover: #1f6391;
      --table-border: #555;
      --header-bg: #555;
      --header-text: #fff;
      --shadow-light: rgba(0, 0, 0, 0.2);
      --shadow-dark: rgba(0, 0, 0, 0.4);
    }
    body {
      margin: 0;
      padding: 0;
      font-family: 'Roboto', sans-serif;
      background: linear-gradient(-45deg, var(--bg-color), #eaeaea, var(--bg-color), #eaeaea);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      transition: background 0.3s, color 0.3s;
      color: var(--text-color);
    }
    body.dark {
      background: var(--bg-color);
    }
    @keyframes gradientBG {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    section {
      min-height: 80vh;
      padding: 20px 10px;
      box-sizing: border-box;
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      animation: fadeInUp 0.8s forwards;
    }
    .module {
      background: var(--container-bg);
      border-radius: 16px;
      box-shadow: 8px 8px 16px var(--shadow-light), -8px -8px 16px var(--shadow-light);
      padding: 20px 30px;
      margin: 10px;
      width: 90%;
      max-width: 900px;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .module:hover {
      transform: scale(1.03);
      box-shadow: 10px 10px 20px var(--shadow-dark), -10px -10px 20px var(--shadow-dark);
    }
    .module h2 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 1.6em;
    }
    .mode-toggle {
      display: inline-block;
      margin: 0 15px;
      padding: 10px 20px;
      border: 2px solid var(--primary-color);
      border-radius: 8px;
      cursor: pointer;
      font-size: 1.1em;
      font-weight: bold;
      color: var(--primary-color);
      transition: background 0.3s, color 0.3s, transform 0.2s;
    }
    .mode-toggle.active {
      background: var(--primary-color);
      color: #fff;
    }
    .mode-toggle:hover {
      transform: scale(1.05);
    }
    #sidebar {
      position: fixed;
      top: 30%;
      right: 0;
      transform: translateY(-50%);
      background: var(--container-bg);
      border: 1px solid var(--primary-color);
      border-radius: 8px 0 0 8px;
      padding: 15px;
      z-index: 1000;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    #sidebar:hover {
      transform: translateY(-50%) scale(1.05);
      box-shadow: 2px 2px 10px var(--shadow-dark);
    }
    #sidebar ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    #sidebar li {
      margin: 25px 0;
    }
    #sidebar li::before {
      content: "• ";
      color: var(--primary-color);
      font-weight: bold;
    }
    #sidebar a {
      text-decoration: none;
      color: var(--text-color);
      font-weight: bold;
      transition: color 0.3s;
    }
    #sidebar a.active {
      color: var(--primary-color);
    }
    #backToTop {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      background: var(--primary-color);
      color: #fff;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 1000;
      font-size: 24px;
      transition: transform 0.3s;
    }
    #backToTop:hover {
      transform: scale(1.1);
    }
    .toggle-dark {
      position: fixed;
      top: 20px;
      right: 80px;
      z-index: 1000;
      background: var(--primary-color);
      border: none;
      border-radius: 50%;
      width: 48px;
      height: 48px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      color: #fff;
      font-size: 10px;
      transition: background 0.3s;
    }
    .toggle-dark:hover {
      background: var(--primary-hover);
    }
    input[type="number"], select {
      padding: 8px;
      border: 1px solid var(--primary-color);
      border-radius: 4px;
      font-size: 1.1em;
      margin-left: 10px;
      transition: border-color 0.3s;
    }
    input[type="number"]:focus, select:focus {
      border-color: var(--primary-hover);
    }
    button {
      background: var(--primary-color);
      color: #fff;
      border: none;
      padding: 10px 20px;
      font-size: 1.1em;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 10px;
      transition: background 0.3s, transform 0.2s;
    }
    button:hover {
      background: var(--primary-hover);
      transform: scale(1.05);
    }
    .result {
      margin-top: 20px;
      padding: 15px;
      background: #ecf0f1;
      border-radius: 8px;
      text-align: center;
      font-size: 1.4em;
      font-weight: bold;
      color: var(--primary-color);
      opacity: 0;
      transition: opacity 0.5s;
    }
    .result.visible {
      opacity: 1;
    }
    .table-container {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      margin-top: 20px;
    }
    .table-box {
      width: 48%;
      margin-bottom: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 12px 16px;
      text-align: center;
      vertical-align: middle;
      border-bottom: 1px solid var(--primary-color);
      font-size: 1.1em;
    }
    th {
      background: var(--primary-color);
      color: #fff;
    }
    @media (max-width: 600px) {
      .table-box {
        width: 100%;
      }
      #sidebar {
        display: none;
      }
      .mode-toggle {
        margin: 5px 0;
        display: block;
        width: 100%;
        text-align: center;
      }
      .module {
        padding: 15px 20px;
      }
      .chart-container {
        height: 300px;
      }
    }
    .chart-container {
      position: relative;
      margin: auto;
      height: 450px;
      width: 100%;
    }
    #hiddenCredits {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: var(--primary-color);
      color: #fff;
      text-align: center;
      padding: 15px;
      box-shadow: 0 -4px 12px rgba(0,0,0,0.3);
      transform: translateY(100%);
      transition: transform 0.3s ease;
      z-index: 1001;
      font-size: 1em;
    }
    #hiddenCredits.visible {
      transform: translateY(0);
    }
  </style>
</head>
<body>
  <nav id="sidebar">
    <ul>
      <li><a href="#calculator" data-target="calculator">換算器</a></li>
      <li><a href="#common" data-target="common">常用換算</a></li>
      <li><a href="#chartSection" data-target="chartSection">關係圖</a></li>
    </ul>
  </nav>
  <button class="toggle-dark" id="toggleDark"></button>
  <div id="backToTop">↑</div>
  <section id="calculator">
    <div class="module">
      <h2>卡片數 / 回合數 換算器</h2>
      <div style="text-align: center; margin-bottom: 20px;">
        <span class="mode-toggle active" id="btnR2C">回合 → 卡片</span>
        <span class="mode-toggle" id="btnC2R">卡片 → 回合</span>
      </div>
      <div style="text-align: center;">
        <label for="inputValue" style="font-size:1.2em; font-weight: bold;">輸入數字：</label>
        <input type="number" id="inputValue" min="1" value="100">
        <button id="calcBtn">計算</button>
        <div class="result" id="result">→ </div>
      </div>
    </div>
  </section>
  <section id="common">
    <div class="module">
      <h2>常用換算</h2>
      <div class="table-container">
        <div class="table-box">
          <h3>回合 → 卡片</h3>
          <table id="r2cTable">
            <thead>
              <tr>
                <th>回合數</th>
                <th>卡片數 (箱數)</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="table-box">
          <h3>卡片 → 回合</h3>
          <table id="c2rTable">
            <thead>
              <tr>
                <th>卡片數 (箱數)</th>
                <th>回合數</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </section>
  <section id="chartSection">
    <div class="module">
      <h2>卡片總量與回合數的關係圖</h2>
      <div class="chart-container">
        <canvas id="chart"></canvas>
      </div>
    </div>
  </section>
  <div id="hiddenCredits">網頁、圖表製作：Discord 𝕫𝕙𝕚𝕝𝕚 @zhili_71</div>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.1.0"></script>
  <script>
    let myChart;
    document.addEventListener("DOMContentLoaded", function() {
      if(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches){
        document.body.classList.add("dark");
      }
      const toggleDarkBtn = document.getElementById("toggleDark");
      function renderToggleBtn(){
        if(document.body.classList.contains("dark")){
          toggleDarkBtn.innerHTML = getSunSVG() + "<span style='font-size:10px;'>白天</span>";
        } else {
          toggleDarkBtn.innerHTML = getMoonSVG() + "<span style='font-size:10px;'>黑夜</span>";
        }
      }
      function getSunSVG(){
        return `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="5"/>
          <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" stroke="currentColor" stroke-width="2"/>
          </svg>`;
      }
      function getMoonSVG(){
        return `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
          <path d="M21 12.79A9 9 0 0 1 11.21 3 7 7 0 0 0 12 17a7 7 0 0 0 9-4.21z"/>
          </svg>`;
      }
      renderToggleBtn();
      toggleDarkBtn.addEventListener("click", function() {
        document.body.classList.toggle("dark");
        renderToggleBtn();
      });
      document.getElementById("backToTop").addEventListener("click", function() {
        window.scrollTo({ top: 0, behavior: "smooth" });
      });
      const sections = document.querySelectorAll("section");
      const sidebarLinks = document.querySelectorAll("#sidebar a");
      const observerOptions = { root: null, rootMargin: "0px", threshold: 0.5 };
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if(entry.isIntersecting){
            sidebarLinks.forEach(link => {
              link.classList.toggle("active", link.getAttribute("data-target") === entry.target.id);
            });
          }
        });
      }, observerOptions);
      sections.forEach(section => observer.observe(section));
      sidebarLinks.forEach(link => {
        link.addEventListener("click", function(e){
          e.preventDefault();
          const targetId = this.getAttribute("href").substring(1);
          document.getElementById(targetId).scrollIntoView({ behavior: "smooth" });
        });
      });
      let mode = "r2c";
      const btnR2C = document.getElementById("btnR2C");
      const btnC2R = document.getElementById("btnC2R");
      btnR2C.addEventListener("click", function(){
        mode = "r2c";
        btnR2C.classList.add("active");
        btnC2R.classList.remove("active");
      });
      btnC2R.addEventListener("click", function(){
        mode = "c2r";
        btnC2R.classList.add("active");
        btnR2C.classList.remove("active");
      });
      function roundsToCards(t){
        t = Number(t);
        let r = Math.min(t,45);
        let base = Math.floor(r/5)*8 + [0,1,2,4,5][r%5];
        let extra = 0;
        const ranges = [
          {a:46, b:111, f:1},
          {a:112, b:500, f:2},
          {a:501, b:1000, f:3},
          {a:1001, b:1500, f:4},
          {a:1501, b:t, f:5}
        ];
        ranges.forEach(({a,b,f})=>{
          if(t>=a){
            let x = Math.min(t,b);
            extra += 2*f*((x-a+1) + 2*(Math.floor((x+1)/2)-Math.floor(a/2)));
          }
        });
        return base+extra;
      }
      function cardsToRounds(x){
        x = Number(x);
        let l = 1, h = 1;
        while(roundsToCards(h)<x){ h*=2; }
        while(l<h){
          let m = Math.floor((l+h)/2);
          if(roundsToCards(m)<x){ l = m+1; }
          else { h = m; }
        }
        return l;
      }
      document.getElementById("calcBtn").addEventListener("click", function(){
        const inputValue = document.getElementById("inputValue").value;
        let result;
        if(mode==="r2c"){
          result = roundsToCards(inputValue) + " 卡片";
        } else {
          result = cardsToRounds(inputValue) + " 回合";
        }
        const resultDiv = document.getElementById("result");
        resultDiv.innerText = "→ " + result;
        resultDiv.classList.add("visible");
      });
      function populateTables(){
        const r2cValues = [111,200,300,1000,1500,2000,2500,10000,20000];
        const c2rValues = [40,400,4000,8000,12000,16000,20000,40000,400000];
        const r2cBody = document.getElementById("r2cTable").querySelector("tbody");
        r2cValues.forEach(rounds=>{
          const cards = roundsToCards(rounds);
          const boxes = Math.floor(cards/40);
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${rounds}</td><td>${cards} 卡 (${boxes} 箱)</td>`;
          r2cBody.appendChild(tr);
        });
        const c2rBody = document.getElementById("c2rTable").querySelector("tbody");
        c2rValues.forEach(cards=>{
          const rounds = cardsToRounds(cards);
          const boxes = Math.floor(cards/40);
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${cards} 卡 (${boxes} 箱)</td><td>${rounds}</td>`;
          c2rBody.appendChild(tr);
        });
      }
      populateTables();
      function generateChart(){
        const dataPoints = [];
        const maxRounds = 1600;
        const step = 50;
        for(let r=0; r<=maxRounds; r+=step){
          dataPoints.push({x:r, y:roundsToCards(r)});
        }
        const maxY = roundsToCards(maxRounds);
        const marker45 = roundsToCards(45);
        const marker111 = roundsToCards(111);
        const marker501 = roundsToCards(501);
        const marker1001 = roundsToCards(1001);
        const marker1501 = roundsToCards(1501);
        const ctx = document.getElementById("chart").getContext("2d");
        myChart = new Chart(ctx, {
          type: "line",
          data: {
            datasets: [{
              label: "卡片數",
              data: dataPoints,
              borderColor: "rgba(75,192,192,1)",
              backgroundColor: "rgba(75,192,192,0.2)",
              pointRadius: 3,
              fill: false,
              tension: 0.1
            }]
          },
          options: {
            responsive: true,
            animation: { duration: 800 },
            plugins: {
              tooltip: {
                mode: "index",
                intersect: false,
                callbacks: {
                  label: function(context){
                    return "回合: " + context.parsed.x + ", 卡片: " + context.parsed.y;
                  }
                }
              },
              datalabels: { display: false },
              annotation: {
                annotations: {
                  line45: {
                    type: "line",
                    scaleID: "x",
                    value: 45,
                    borderColor: "rgba(255,0,0,0.8)",
                    borderWidth: 2,
                    borderDash: [6,3],
                    label: {
                      enabled: true,
                      position: "center",
                      xAdjust: -20,
                      yAdjust: -20,
                      content: ["45回", marker45],
                      backgroundColor: "rgba(0,0,0,0.7)",
                      color: "#fff",
                      font: { weight: "bold", size: 14 },
                      borderRadius: 4,
                      padding: 4
                    }
                  },
                  line111: {
                    type: "line",
                    scaleID: "x",
                    value: 111,
                    borderColor: "rgba(255,0,0,0.8)",
                    borderWidth: 2,
                    borderDash: [6,3],
                    label: {
                      enabled: true,
                      position: "center",
                      xAdjust: 20,
                      yAdjust: -20,
                      content: ["111回", marker111],
                      backgroundColor: "rgba(0,0,0,0.7)",
                      color: "#fff",
                      font: { weight: "bold", size: 14 },
                      borderRadius: 4,
                      padding: 4
                    }
                  },
                  line501: {
                    type: "line",
                    scaleID: "x",
                    value: 501,
                    borderColor: "rgba(255,0,0,0.8)",
                    borderWidth: 2,
                    borderDash: [6,3],
                    label: {
                      enabled: true,
                      position: "center",
                      yAdjust: -20,
                      content: ["501回", marker501],
                      backgroundColor: "rgba(0,0,0,0.7)",
                      color: "#fff",
                      font: { weight: "bold", size: 14 },
                      borderRadius: 4,
                      padding: 4
                    }
                  },
                  line1001: {
                    type: "line",
                    scaleID: "x",
                    value: 1001,
                    borderColor: "rgba(255,0,0,0.8)",
                    borderWidth: 2,
                    borderDash: [6,3],
                    label: {
                      enabled: true,
                      position: "center",
                      yAdjust: -20,
                      content: ["1001回", marker1001],
                      backgroundColor: "rgba(0,0,0,0.7)",
                      color: "#fff",
                      font: { weight: "bold", size: 14 },
                      borderRadius: 4,
                      padding: 4
                    }
                  },
                  line1501: {
                    type: "line",
                    scaleID: "x",
                    value: 1501,
                    borderColor: "rgba(255,0,0,0.8)",
                    borderWidth: 2,
                    borderDash: [6,3],
                    label: {
                      enabled: true,
                      position: "center",
                      yAdjust: -20,
                      content: ["1501回", marker1501],
                      backgroundColor: "rgba(0,0,0,0.7)",
                      color: "#fff",
                      font: { weight: "bold", size: 14 },
                      borderRadius: 4,
                      padding: 4
                    }
                  }
                }
              }
            },
            scales: {
              x: {
                type: "linear",
                title: { display: true, text: "回合數" },
                min: 0,
                max: maxRounds
              },
              y: {
                title: { display: true, text: "卡片數" },
                min: 0,
                max: maxY,
                ticks: { stepSize: 3000 }
              }
            },
            onHover: function(e) {}
          }
        });
      }
      generateChart();
      const hiddenCredits = document.getElementById("hiddenCredits");
      window.addEventListener("scroll", function(){
        if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 150){
          hiddenCredits.classList.add("visible");
        } else {
          hiddenCredits.classList.remove("visible");
        }
      });
    });
  </script>
</body>
</html>
